README for building a STAGING area.

A staging area is being built for testing various versions of apache, mysql and php.
The versions being used currently are.


Apache
------
2.0.54


MySQL
-----
4.0.25
4.1.13


PHP
---
4.0.6
4.1.2
4.2.3
4.3.11
4.4.0


Zend Optimizer
--------------
2.5.7
2.5.10



The following combinations will be build
--------------------------------------------------
S.No   Apache    PHP      MySQL     Zend Optimizer
--------------------------------------------------
1      2.0.54    4.0.6    4.0.25       -
2      2.0.54    4.1.2    4.0.25       -
3      2.0.54    4.2.3    4.0.25       -
4      2.0.54    4.3.11   4.1.13       -
5      2.0.54    4.4.0    4.1.13       -
6      2.0.54    5.0.4    4.1.13       -
--------------------------------------------------
The above six combinations will run on port 81 to 86 respectively






Building the staging server
---------------------------
1 - Add a new hdd of atleast 80Gb and create the partition
    /staging/ 
    also create a directory
    /staging/etc/

2 - Download all the distributions (sources)

    apache - httpd-2.0.54.tar.bz2

    mysql  - mysql-4.0.25.tar.gz
             mysql-4.1.13.tar.gz

    php    - php-4.0.6.tar.gz
             php-4.1.2.tar.gz
             php-4.2.3.tar.gz
             php-4.3.11.tar.bz2
             php-4.4.0.tar.bz2
             php-5.0.4.tar.bz2



3 - untar sources and build apache, mysql, php and install it in



    /staging/apache-2.0.54

$ ./configure --prefix=/staging/apache-2.0.54 --enable-so --enable-mods-shared=auth_anon auth_dbm auth_digest cache cern-meta cgid charset_lite dav dav_fs deflate disk_cache echo example expires ext_filter file_cache headers info isapi log_forensic logio mem_cache mime_magic nw_ssl proxy proxy_connect proxy_ftp proxy_http rewrite speling ssl suexec unique_id usertrack vhost_alias



    /staging/mysql-4.0.25
$ ./configure --prefix=/staging/mysql-4.0.25
recommended
$ ./configure --prefix=/staging/mysql-4.0.25 --with-unix-socket-path=/tmp/mysql-4.0.25.sock --with-tcp-port=3307


    /staging/mysql-4.1.13




    /staging/php-4.0.6
    /staging/php-4.1.2
    /staging/php-4.2.3
    /staging/php-4.3.11
    /staging/php-4.4.0
    /staging/php-5.0.4


4 - modify the apachectl and conf files for apache

    /staging/apache-2.0.54/bin/apachectl
    /staging/apache-2.0.54/conf/httpd.conf.php<version>.mysql<version>

    sample config files in /staging/apache-2.0.54 are
      httpd.conf.php-4.0.6.mysql-4.0.25
      httpd.conf.php-4.1.2.mysql-4.0.25
      httpd.conf.php-4.2.3.mysql-4.0.25
      httpd.conf.php-4.3.11.mysql-4.1.13
      httpd.conf.php-4.4.0.mysql-4.1.13
      httpd.conf.php-5.0.4.mysql-4.1.13








Note1:
-----
while installing MySQL from source ensure that the right configuration file is used
so in the quick install steps of mysql
     shell> groupadd mysql
     shell> useradd -g mysql mysql
     shell> gunzip < mysql-VERSION.tar.gz | tar -xvf -
     shell> cd mysql-VERSION
     shell> ./configure --prefix=/usr/local/mysql
     shell> make
     shell> make install
     shell> cp support-files/my-medium.cnf /etc/my.cnf
     shell> cd /usr/local/mysql
     shell> bin/mysql_install_db --user=mysql
     shell> chown -R root  .
     shell> chown -R mysql var
     shell> chgrp -R mysql .
     shell> bin/mysqld_safe --user=mysql &

replace them with
     shell> groupadd mysql
     shell> useradd -g mysql mysql
     shell> gunzip < mysql-VERSION.tar.gz | tar -xvf -
     shell> cd mysql-VERSION
     shell> ./configure --prefix=/staging/mysql-4.0.25
     shell> make
     shell> make install
     shell> cp support-files/my-medium.cnf /staging/etc/mysql-4.0.25.cnf
     shell> cd /staging/mysql-4.0.25
     shell> bin/mysql_install_db --defaults-file=/staging/etc/mysql-4.0.25.cnf --user=mysql
     shell> chown -R root  .
     shell> chown -R mysql var
     shell> chgrp -R mysql .
     shell> bin/mysqld_safe --defaults-file=/staging/etc/mysql-4.0.25 --user=mysql &



Note2
-----
compile options for php 4.3.11

./configure --prefix=/staging/php-4.3.11 --with-apxs2=/staging/apache-2.0.54/bin/apxs --enable-cli --with-curl --with-zlib --with-mysql=/staging/mysql-4.0.25 --with-mhash --enable-mbstring --with-bz2 --enable-calendar --with-iconv --with-gettext




While doing a make install for php 4.3.11 i got the following error.
Cannot find /staging/apache-2.0.54/conf/httpd.conf

this was because i wanted to use the conf file /staging/apache-2.0.54/conf/httpd.conf.php-4.3.11.mysql-4.0.25

to overcome this problem do

cd /staging/apache-2.0.54/conf/
cp httpd.conf.php-4.3.11.mysql-4.0.25 httpd.conf

do a make install
and then do 
cp httpd.conf httpd.conf.php-4.3.11.mysql-4.0.25


also a library
/staging/apache-2.0.54/modules/libphp4.so is generated.
do a 
mv libphp-4.3.11.mysql-4.0.25.so

and edit the configuration file
/staging/apache-2.0.54/conf/httpd.conf.php-4.3.11.mysql-4.0.25

and change the line
# LoadModule php4_module        modules/libphp4.so
LoadModule php4_module        modules/libphp-4.3.11.mysql-4.0.25.so
