<?xml version="1.0" encoding="iso-8859-1" ?>

<table>
  <base>CRM/Order</base>
  <class>OrderLineSubItem</class>
  <name>civicrm_order_line_sub_item</name>
  <add>1.7</add> 
  <change>4.1</change>
  <changedName>civicrm_line_item</changedName>
  <log>true</log>
  <field>
      <name>id</name>
      <uniqueName>order_line_sub_item_id</uniqueName>
      <type>int unsigned</type>
      <required>true</required>
      <comment>Order Line Sub Item</comment>
      <add>4.1</add>
  </field>
  <primaryKey>
      <name>id</name>
      <autoincrement>true</autoincrement>
  </primaryKey>
  <field>
      <name>order_line_item_id</name>
      <type>int unsigned</type>
      <required>true</required>
      <comment>FK to order_line_item</comment>
      <add>4.1</add>
  </field>
  <foreignKey>
      <name>order_line_item_id</name>
      <table>civicrm_order_line_item</table>
      <key>id</key>
  </foreignKey>
  <field>
      <name>price_field_id</name>
      <type>int unsigned</type>
      <required>true</required>
      <comment>FK to price_field</comment>
      <add>1.7</add>
  </field>
  <foreignKey>
      <name>price_field_id</name>
      <table>civicrm_price_field</table>
      <key>id</key>
  </foreignKey>
  <field>
      <name>option_group_id</name>
      <type>int unsigned</type>
      <required>true</required>
      <comment>FK to option group</comment>
      <add>1.7</add>
      <drop>3.3</drop>
  </field>
  <field>
      <name>label</name>
      <type>varchar</type>
      <length>255</length>
      <required>true</required>
      <comment>descriptive label for item - from custom_option.label</comment>
      <add>1.7</add>
  </field>
  <field>
      <name>qty</name>
      <type>int unsigned</type>
      <required>true</required>
      <comment>How many items ordered</comment>
      <add>1.7</add>
  </field>
  <field>
      <name>unit_price</name>
      <type>decimal</type>
      <required>true</required>
      <comment>price of each item</comment>
      <add>1.7</add>
  </field>
  <field>
      <name>line_total</name>
      <type>decimal</type>
      <required>true</required>
      <comment>qty * unit_price</comment>
      <add>1.7</add>
  </field>
  <field>  
      <name>financial_account_id</name>  
      <title>Financial Account</title>
      <type>int unsigned</type>
      <comment>FK to Financial Account. NB: Account for (line_total - non_deductible_line_total), NOT line_total</comment>
      <add>4.1</add> 
  </field>    
  <foreignKey>  
       <name>financial_account_id</name>  
       <table>civicrm_financial_account</table>  
       <key>id</key>         
       <add>4.1</add>  
  </foreignKey> 
  <field>
      <name>non_deductible_unit_price</name>
      <type>decimal</type>
      <required>true</required>
      <comment>non deductible price of each item</comment>
      <add>4.1</add>
  </field>
  <field>
      <name>non_deductible_line_total</name>
      <type>decimal</type>
      <required>true</required>
      <comment>qty * non_deductible_unit_price</comment>
      <add>4.1</add>
  </field>
  <field>  
      <name>non_deductible_account_id</name>  
      <title>Non Deductible Financial Account</title>
      <type>int unsigned</type>
      <comment>FK to Account. NB: Financial Account for (line_total - non_deductible_line_total), NOT line_total</comment>
      <add>4.1</add> 
      <devNote>copied from civicrm_price_field_value at time of contribution</devNote>
  </field>    
  <foreignKey>  
       <name>non_deductible_account_id</name>  
       <table>civicrm_financial_account</table>  
       <key>id</key>         
       <add>4.1</add>  
  </foreignKey>  
  <field>
      <name>participant_count</name>
      <type>int unsigned</type>
      <default>NULL</default>
      <comment>Participant count for line sub item</comment>
      <add>3.2</add>
  </field>
  <index>
      <name>UI_line_sub_item_value</name>
      <fieldName>order_line_item_id</fieldName>
      <fieldName>price_field_value_id</fieldName>
      <fieldName>price_field_id</fieldName>
      <unique>true</unique>
      <add>4.1</add>
  </index>
  <field>
      <name>price_field_value_id</name>
      <type>int unsigned</type>
      <default>NULL</default>
      <comment>Implicit FK to civicrm_option_value</comment>
      <add>3.3</add>
  </field>
  <foreignKey>
      <name>price_field_value_id</name>
      <table>civicrm_price_field_value</table>
      <key>id</key>
      <onDelete>SET NULL</onDelete>
  </foreignKey>
 <field>
      <name>order_status_id</name>
      <title>Order Status</title>
      <type>int unsigned</type>
      <default>1</default>
      <import>true</import>
      <export>false</export>
      <headerPattern>/status/i</headerPattern>
      <add>1.6</add>
      <change>4.1</change>
      <changedName>contribution_status_id</changedName>
  </field>
  <index>
    <name>index_order_status</name>
    <fieldName>order_status_id</fieldName>
    <add>1.6</add>
    <change>4.1</change>
    <changedName>index_contribution_status</changedName>
  </index>
  <field>  
    <name>add_credit_adjustment_id</name>  
    <type>int unsigned</type>  
    <import>true</import>
    <comment>FK to civicrm_credit_adjustment</comment>
    <add>4.1</add>  
  </field> 
  <foreignKey> 
    <name>add_credit_adjustment_id</name> 
    <table>civicrm_credit_adjustment</table> 
    <key>id</key> 
    <add>4.1</add>
    <default>NULL</default>
    <comment>Non-null means this record added by adjustment.</comment>
  </foreignKey>
  <field>  
    <name>delete_credit_adjustment_id</name>  
    <type>int unsigned</type>  
    <import>true</import>
    <comment>FK to civicrm_credit_adjustment</comment>  
    <add>4.1</add>  
  </field> 
  <foreignKey> 
    <name>delete_credit_adjustment_id</name> 
    <table>civicrm_credit_adjustment</table> 
    <key>id</key> 
    <add>4.1</add>
    <default>NULL</default>
    <comment>Non-null means this record deleted (ie cancelled) by adjustment.</comment>
  </foreignKey>

 
</table>

